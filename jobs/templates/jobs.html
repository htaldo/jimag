<!DOCTYPE html>
{% extends 'nav.html' %}
{% load static %}

{% block content %}
<head>
    <link rel="stylesheet" href="{% static 'styles/normalize.css' %}">
    <link rel="stylesheet" href="{% static 'styles/style.css' %}">
    <link rel="stylesheet" href="{% static 'styles/input.css' %}">
    <link rel="stylesheet" href="{% static 'styles/docking.css' %}">
    <title>Jobs</title> 
</head>
<body>
    <h1>New job</h1>

    <!-- form id="runJob" action="{% url 'jobs' %}" method="post" enctype="multipart/form-data" -->

    <div class="jobscontainer">
        {% if message %}
            <div class="result-message">
                {{ message }}
            </div>
        {% endif %}

        <!--jobsbox is each of the three columns that separate
        the menus for protein, chain and ligand-->
        <div class="jobsbox">
            <h2>Ligand</h2>
            <label for="contentSelector2">Select from:</label>
            <select id="contentSelector2" class="content-selector">
                <option value="uploadfile2">Upload file</option>
                <option value="fetchpubchem">Fetch from PubChem</option>
            </select>

            <div id="uploadfile2" class="content-section show">
                <form id="uploadLigandForm" method="post" action="{% url 'process_ligand' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ docking_form.lform }}
                    <br>
                    <br>
                    <button type="button" onclick="submitLigandForm()">Submit ligand</button>
                </form>
                <div id="processingLigand" style="display: none;">Processing ligand...</div>
                <div id="ligandProcessedMessage"></div>
                <script src="{% static 'jobs/submit_ligand_form.js' %}"></script>
            </div>

            <div id="fetchpubchem" class="content-section">
                <h2>Fetch from PubChem</h2>
                <p>This is the content for option 2.</p>
            </div>

            <br>
        </div>
        <div class="jobsbox">
            <h2>Protein</h2>
            <label for="contentSelector1">Select from:</label>
            <select id="contentSelector1" class="content-selector">
                <option value="uploadfile1">Upload file</option>
                <option value="fetchpdb">Fetch from PDB</option>
            </select>

            <!-- show the upload file option by default -->
            <div id="uploadfile1" class="content-section show">
                <form id="uploadProteinForm" method="post" action="{% url 'process_protein' %}" enctype="multipart/form-data">
                    {% csrf_token %}
                    {{ docking_form.pform }}
                    <br>
                    <br>
                    <button type="button" onclick="submitProteinForm()">Submit protein</button>
                </form>
                <div id="processingProtein" style="display: none;">Processing protein...</div>
                <div id="proteinProcessedMessage"></div>
                <script src="{% static 'jobs/submit_protein_form.js' %}"></script>
            </div>

            <div id="fetchpdb" class="content-section">
                <h2>Fetch from PDB</h2>
                <p>This is the content for option 2.</p>
            </div>

            <br>
        </div>
    </div>
    
    <br />
    <div class="jobscontainer" style="height: 500px;">
        <div class="jobsbox">
            <h2>Chains</h2>
            <label for="contentSelector3">Select from:</label>
            <select id="contentSelector3" class="content-selector">
                <option value="tdselection">3D selection</option>
                <option value="chainnames">Chain names</option>
            </select>

            <div id="tdselection" class="content-section show">
                Selected chains: <span id="chainstring"></span>
                <style>
                #chainsviewer {
                    position: absolute;
                    width: 40%;
                    height: 340px;
                }
                </style>
                <!-- 
                    molstar.js and .css are obtained from
                    - the folder build/viewer after cloning and building the molstar package 
                    - from the build/viewer folder in the Mol* NPM package
                -->
                <link rel="stylesheet" type="text/css" href="{% static 'molstar/molstar.css' %}" />
                <script type="text/javascript" src="{% static 'molstar/molstar.js' %}"></script>
                <div id="chainsviewer"></div>
                <script type="text/javascript" type="module" src="{% static 'jobs/chains_bundle.js' %}">
                </script>
            </div>

            <div id="chainnames" class="content-section">
                <h2>Chain names</h2>
            </div>
        </div>

        <div class="jobsbox">
            <h2>Pockets</h2>
            <label for="contentSelector4">Pocket options</label>
            <select id="contentSelector4" class="content-selector">
                <option value="toppockets">Top pockets</option>
                <option value="choosepockets">Choose pockets</option>
            </select>
            <div id="toppockets" class="content-section show">
                    <!-- https://www.w3schools.com/html/html_form_input_types.asp -->
                <label for="maxpockets">Maximum number of pockets (if available):</label>
                <input type="number" id="maxpockets" name="maxpockets" value="1" min="1" max="16">
            </div>
            <div id="choosepockets" class="content-section" style="height: 350px; overflow-y: auto;">
                <button type="button" onclick="loadPockets()">Choose pockets</button>
                <script src="{% static 'jobs/pockets_funcs.js' %}"></script>
                <table id="pocketsTable">
                    <thead>
                        <tr>
                            <th>Choose</th>
                            <th>Rank</th>
                            <th>Score</th>
                            <th>Probability</th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <center>
    <h2>More settings</h2>

    <form id="settingsForm">
        <!-- https://www.w3schools.com/html/html_form_input_types.asp -->
        <label for="exhaustiveness">Exhaustiveness (between 1 and 64):</label>
        <input type="number" id="exhaustiveness" name="exhaustiveness" value="8" min="1" max="64">
        <br>
        <label for="modes">Number of modes (conformers) (between 1 and 20):</label>
        <input type="number" id="modes" name="modes" value="9" min="1" max="20">
    </form>

    <form id="runJob" method="post" action="{% url 'jobs' %}" enctype="multipart/form-data">
        {% csrf_token %}
        <button type="button" onclick="submitDockingForm()">Run job!</button>
    </form>
    <script src="{% static 'jobs/submit_docking_form.js' %}"></script>
    </center>
    <script src="{% static 'jobs/dropdown.js' %}"></script>

    <!-- /form -->

</body>
{% endblock %}

</html>
